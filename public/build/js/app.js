let pagina=1;const cita={usuario:"",nombre:"",fecha:"",hora:"",pagar:"0",servicios:[]},expresion={nombre:/^[a-zA-ZÀ-ÿ\s]{4,40}$/};function iniciarApp(){mostrarServicios(),mostrarSeccion(),cambiarSeccion(),paginaSiguiente(),paginaAnterior(),botonesPaginador(),nombreCliente(),fechaCliente(),horaCliente(),deshabilitarFechaAnterior()}document.addEventListener("DOMContentLoaded",(function(){try{iniciarApp()}catch(e){}}));const currency=function(e){return new Intl.NumberFormat("es-co",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e)};async function mostrarServicios(){try{const e="http://localhost:4000/api/servicios",t=await fetch(e);(await t.json()).forEach(e=>{const{id:t,nombre:n,precio:a}=e,o=document.createElement("P");o.textContent=n,o.classList.add("nombre-servicio");const c=document.createElement("P");c.textContent="$"+a,c.textContent=currency(a),c.classList.add("precio-servicio");const r=document.createElement("DIV");r.classList.add("servicio"),r.dataset.idServicio=t,r.onclick=function(){seleccionarServicio(e)},r.appendChild(o),r.appendChild(c),document.querySelector("#servicio").appendChild(r)})}catch(e){console.log(e)}}function seleccionarServicio(e){const{id:t}=e,{servicios:n}=cita,a=document.querySelector(`[data-id-servicio="${t}"]`);n.some(e=>e.id===t)?(cita.servicios=n.filter(e=>e.id!==t),a.classList.remove("seleccionado")):(cita.servicios=[...n,e],a.classList.add("seleccionado"))}function nombreCliente(){cita.nombre=document.querySelector("#Nombre").value,cita.usuario=document.querySelector("#usuario").value}function deshabilitarFechaAnterior(){const e=document.getElementById("fecha"),t=new Date,n=t.getFullYear(),a=t.getMonth()+1,o=t.getDate(),c=`${n}-${a<10?"0"+a:a}-${o<10?"0"+o:o}`;e.min=c}function fechaCliente(){const e=document.querySelector("#fecha");var t=new Date,n=t.getMonth()+1,a=t.getDate(),o=t.getFullYear();const c=t.getUTCDay();a<10&&(a="0"+a),n<10&&(n="0"+n),[6,0].includes(c)||(e.value=o+"-"+n+"-"+a,cita.fecha=e.value),e.addEventListener("input",(function(t){const n=new Date(t.target.value).getUTCDay();[6,0].includes(n)?(t.preventDefault(),e.value="",mostrar_Alerta("No hay servicio para el día seleccionado.")):cita.fecha=document.querySelector("#fecha").value}))}function horaCliente(){const e=document.querySelector("#hora");e.addEventListener("input",t=>{const n=t.target.value.split(":");n[0]<8||n[0]>18?(t.preventDefault(),e.value="",mostrar_Alerta("No hay servicio disponible a la hora seleccionada.")):cita.hora=document.querySelector("#hora").value})}function mostrar_Alerta(e,t=null){const n=document.querySelector(".contenedor-error");if(n){n.remove();const t=document.createElement("DIV");t.classList.add("contenedor-error");const a=document.createElement("DIV");a.classList.add("alerta"),a.classList.add("error");const o=document.createElement("P");o.textContent=e,a.appendChild(o),t.appendChild(a),document.querySelector(".app").appendChild(t),setTimeout((function(){t.remove()}),7e3)}else{const t=document.createElement("DIV");t.classList.add("contenedor-error");const n=document.createElement("DIV");n.classList.add("alerta"),n.classList.add("error");const a=document.createElement("P");a.textContent=e,n.appendChild(a),t.appendChild(n),document.querySelector(".app").appendChild(t),setTimeout((function(){t.remove()}),7e3)}}function mostrarResumen(){const{nombre:e,fecha:t,hora:n,servicios:a}=cita,o=document.querySelector(".contenido-resumen");for(;o.firstChild;)o.removeChild(o.firstChild);if(Object.values(cita).includes("")||0===a.length){const e=document.createElement("P");return e.textContent="Falta completar campos o seleccionar servicios",e.classList.add("invalidar-cita"),void o.appendChild(e)}const c=document.querySelector(".contenedor-error");c&&c.remove();const r=document.createElement("DIV");r.classList.add("resumen");const i=document.createElement("H3");i.textContent="Datos de Reserva";const s=document.createElement("P");s.innerHTML='<span class="negrita">Nombre:</span> '+e;const d=new Date(t),l=d.getMonth(),u=d.getDate()+2,m=d.getFullYear(),p=new Date(Date.UTC(m,l,u)).toLocaleDateString("es-CO",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),h=n.split(":");var v="";let C;h[0]<12?v="a.m.":h[0]>11&&(v="p.m."),C=h>12?h[0]-12:h[0];const g=document.createElement("P");g.innerHTML='<span class="negrita">Fecha:</span> '+p;const f=document.createElement("P");f.innerHTML=`<span class="negrita">Hora:</span> ${C}:${h[1]} ${v}`;const y=document.createElement("DIV");y.classList.add("resumen-servicios");const S=document.createElement("H3");S.textContent="Servicios",y.appendChild(S);let L=0;a.forEach(e=>{const{nombre:t,precio:n}=e,a=document.createElement("DIV");a.classList.add("contenedor-servicio");const o=document.createElement("P");o.textContent=t;const c=document.createElement("P");c.textContent=currency(n),c.classList.add("precio");const r=Number(n);L+=r,a.appendChild(o),a.appendChild(c),y.appendChild(a)}),o.appendChild(r),r.appendChild(i),r.appendChild(s),r.appendChild(g),r.appendChild(f),r.appendChild(y);const E=document.createElement("H3");E.classList.add("total"),cita.pagar=L,E.innerHTML=`Total: <span>${currency(L)}</span>`,r.appendChild(E);const b=document.createElement("BUTTON");b.classList.add("btn-reservar"),b.textContent="Reservar",b.onclick=reservarCita,o.appendChild(b)}async function reservarCita(){const e=document.querySelector(".btn-reservar");e.disabled=!0;const{usuario:t,fecha:n,hora:a,servicios:o,pagar:c}=cita,r=o.map(e=>e.id),i=new FormData;i.append("usuario",t),i.append("fecha",n),i.append("hora",a),i.append("servicios",r),i.append("total",c);try{const e="http://localhost:4000/api/citas",t=await fetch(e,{method:"POST",body:i});(await t.json()).resultado&&Swal.fire({position:"center",icon:"success",title:"Reserva Creada",text:"Tu reserva se creo con correctamente",button:"OK"}).then(()=>{window.location.reload()})}catch(e){console.log(e),Swal.fire({icon:"error",title:"Error",text:"No pudimos guardar tu reserva, intenta nuevamente más tarde"}).then(()=>{window.location.reload()})}e.disabled=!1}function mostrarSeccion(){const e=document.querySelector(".mostrar-seccion");e&&e.classList.remove("mostrar-seccion");document.querySelector("#paso-"+pagina).classList.add("mostrar-seccion");const t=document.querySelector(".actual");t&&t.classList.remove("actual");document.querySelector(`[data-paso="${pagina}"]`).classList.add("actual")}function cambiarSeccion(){document.querySelectorAll(".tabs button").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),pagina=parseInt(e.target.dataset.paso),mostrarSeccion(),botonesPaginador()})})}function paginaSiguiente(){document.querySelector("#siguiente").addEventListener("click",()=>{pagina++,botonesPaginador()})}function paginaAnterior(){document.querySelector("#anterior").addEventListener("click",()=>{pagina--,botonesPaginador()})}function botonesPaginador(){const e=document.querySelector("#siguiente"),t=document.querySelector("#anterior");1===pagina?(t.classList.add("ocultar"),e.classList.remove("ocultar")):3===pagina?(t.classList.remove("ocultar"),e.classList.add("ocultar"),mostrarResumen()):(t.classList.remove("ocultar"),e.classList.remove("ocultar")),mostrarSeccion()}